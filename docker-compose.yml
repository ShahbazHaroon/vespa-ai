services:
  vespa:
    image: vespaengine/vespa
    container_name: vespa
    hostname: vespa
    ports:
      - "8080:8080" # Vespa HTTP port
      - "19071:19071" # Vespa metrics/admin port
    volumes:
      - ./semantic-search-vespa/vespa-app:/app
    command: >
      bash -c "cd /app &&
               /opt/vespa/bin/vespa-deploy prepare . &&
               /opt/vespa/bin/vespa-deploy activate &&
               tail -f /dev/null"
    restart: on-failure

  sb-vespa-ai:
    build:
      context: . # Project root as context
    container_name: sb-vespa-ai
    ports:
      - "8081:8080"  # Expose Spring Boot API externally
    depends_on:
      - vespa
    environment:
      - VESPA_HOST=http://vespa:8080
    restart: on-failure
